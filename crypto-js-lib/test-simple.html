<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç°¡å–®æ¸¬è©¦é é¢</title>
  <script type="importmap">
    {
      "imports": {
        "hash-wasm": "https://cdn.jsdelivr.net/npm/hash-wasm@4.11.0/dist/index.esm.min.js"
      }
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    .result {
      margin: 10px 0;
      padding: 10px;
      background: #f0f0f0;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
    }
    .error {
      border-left-color: #f44336;
      background: #ffebee;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
  <h1>ğŸ” Crypto Library ç°¡å–®æ¸¬è©¦</h1>
  
  <h2>1. AES åŠ å¯†æ¸¬è©¦</h2>
  <button onclick="testAES()">æ¸¬è©¦ AES</button>
  <div id="aesResult"></div>
  
  <h2>2. RSA åŠ å¯†æ¸¬è©¦</h2>
  <button onclick="testRSA()">æ¸¬è©¦ RSA</button>
  <div id="rsaResult"></div>
  
  <h2>3. SHA å“ˆå¸Œæ¸¬è©¦</h2>
  <button onclick="testSHA()">æ¸¬è©¦ SHA-256</button>
  <div id="shaResult"></div>
  
  <h2>4. PBKDF2 æ¸¬è©¦</h2>
  <button onclick="testPBKDF2()">æ¸¬è©¦ PBKDF2</button>
  <div id="pbkdf2Result"></div>

  <script type="module">
    import { CryptoInitializer, Pbkdf2Strategy } from './src/index.js';
    
    // æ¸¬è©¦ AES
    window.testAES = async function() {
      const resultDiv = document.getElementById('aesResult');
      try {
        resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
        
        const plainText = 'Hello, World!';
        const key = 'mySecretKey123';
        
        await CryptoInitializer.initAesSetting(key);
        const context = CryptoInitializer.getAesContextForEncryptByRandomIV();
        
        const encResult = await context.encryptWithIVToBase64(plainText);
        
        if (encResult.success) {
          const decContext = CryptoInitializer.getAesContextForDecryptByRandomIV(encResult.iv);
          const decResult = await decContext.decryptFromBase64(encResult.cipherText);
          
          resultDiv.className = 'result';
          resultDiv.innerHTML = `
            âœ… AES æ¸¬è©¦æˆåŠŸ!<br>
            åŸæ–‡: ${plainText}<br>
            å¯†æ–‡: ${encResult.cipherText.substring(0, 50)}...<br>
            è§£å¯†: ${decResult.data}
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
        console.error('AES Error:', error);
      }
    };
    
    // æ¸¬è©¦ RSA
    window.testRSA = async function() {
      const resultDiv = document.getElementById('rsaResult');
      try {
        resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
        
        const plainText = 'RSA Test Message';
        
        const keys = await CryptoInitializer.rsaGenerateKeys(2048);
        await CryptoInitializer.initRsaSetting(keys.publicKey, keys.privateKey);
        
        const context = CryptoInitializer.getRsaContext();
        const encResult = await context.encryptToBase64(plainText);
        
        if (encResult.success) {
          const decResult = await context.decryptFromBase64(encResult.data);
          
          resultDiv.className = 'result';
          resultDiv.innerHTML = `
            âœ… RSA æ¸¬è©¦æˆåŠŸ!<br>
            åŸæ–‡: ${plainText}<br>
            å¯†æ–‡: ${encResult.data.substring(0, 50)}...<br>
            è§£å¯†: ${decResult.data}
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
        console.error('RSA Error:', error);
      }
    };
    
    // æ¸¬è©¦ SHA
    window.testSHA = async function() {
      const resultDiv = document.getElementById('shaResult');
      try {
        resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
        
        const text = 'Hello World';
        const context = CryptoInitializer.getSha256HashContext();
        const result = await context.encryptToBase64(text);
        
        if (result.success) {
          resultDiv.className = 'result';
          resultDiv.innerHTML = `
            âœ… SHA-256 æ¸¬è©¦æˆåŠŸ!<br>
            åŸæ–‡: ${text}<br>
            å“ˆå¸Œ: ${result.data}
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
        console.error('SHA Error:', error);
      }
    };
    
    // æ¸¬è©¦ PBKDF2
    window.testPBKDF2 = async function() {
      const resultDiv = document.getElementById('pbkdf2Result');
      try {
        resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';
        
        const password = 'myPassword123';
        const { base64Salt, bytesSalt } = CryptoInitializer.generateSalt(16);
        
        const pbkdf2 = new Pbkdf2Strategy();
        const derivedKey = await CryptoInitializer.deriveKeyFromPasswordToBase64(
          password,
          bytesSalt,
          pbkdf2,
          10000,
          32
        );
        
        resultDiv.className = 'result';
        resultDiv.innerHTML = `
          âœ… PBKDF2 æ¸¬è©¦æˆåŠŸ!<br>
          å¯†ç¢¼: ${password}<br>
          é¹½: ${base64Salt}<br>
          æ´¾ç”Ÿå¯†é‘°: ${derivedKey}
        `;
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
        console.error('PBKDF2 Error:', error);
      }
    };
    
    console.log('âœ… æ¸¬è©¦é é¢å·²è¼‰å…¥');
  </script>
</body>
</html>
