<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œç¶“æ­· - å±¥æ­·ç³»çµ±</title>
    <link rel="stylesheet" href="./styles/navigation.css">
    <link rel="stylesheet" href="./styles/work-experience-table.css">
    <link rel="stylesheet" href="./styles/work-experience-modal.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .hidden {
            display: none !important;
        }

        html, body {
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        @media (max-width: 640px) {
            main {
                padding: 1rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.1rem;
            color: #7f8c8d;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #ecf0f1;
            border-top-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background-color: #fadbd8;
            color: #c0392b;
            padding: 1.5rem;
            border-radius: 4px;
            border-left: 4px solid #e74c3c;
            margin: 2rem 0;
        }

        .error-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        footer {
            background-color: #2c3e50;
            color: #ecf0f1;
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            margin-top: auto;
        }

        footer a {
            color: #3498db;
            text-decoration: none;
            transition: color 0.3s;
        }

        footer a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            main {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- å°è¦½æ¬„ -->
    <nav id="navigation"></nav>

    <!-- ä¸»å…§å®¹å€åŸŸ -->
    <main>
        <div id="work-experience-table"></div>
        <div id="loading" class="loading hidden">
            <span class="loading-spinner"></span>
            <span id="loading-text">æ­£åœ¨è¼‰å…¥å·¥ä½œç¶“æ­·è³‡æ–™...</span>
        </div>
        <div id="error-container"></div>
    </main>

    <!-- æ¨¡æ…‹æ¡†å®¹å™¨ -->
    <div id="modal-container"></div>

    <!-- é è…³ -->
    <footer>
        <p>Â© 2025 å±¥æ­·ç³»çµ±. ç‰ˆæœ¬ 1.0 | æœ€å¾Œæ›´æ–°: <span id="last-updated">2025-11-09</span></p>
        <p><a href="index.html">è¿”å›é¦–é </a> | <a href="portfolio.html">æª¢è¦–ä½œå“é›†</a></p>
    </footer>

    <!-- è¼‰å…¥æ‡‰ç”¨ç¨‹å¼ -->
    <script type="module">
        import { Navigation } from './components/Navigation.js';
        import { WorkExperienceTable } from './components/WorkExperienceTable.js';
        import { WorkExperienceModal } from './components/WorkExperienceModal.js';
        import { WorkExperienceService } from './services/WorkExperienceService.js';
        import { i18nService } from './services/i18nService.js';
        import { LanguageManager } from './services/LanguageManager.js';

        /**
         * é¡¯ç¤º/éš±è—è¼‰å…¥ä¸­ç‹€æ…‹
         */
        function showLoading(show) {
            const loadingEl = document.getElementById('loading');
            if (loadingEl) {
                loadingEl.style.display = show ? 'block' : 'none';
            }
        }

        /**
         * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
         */
        function showError(title = '', message = '') {
            const errorContainer = document.getElementById('error-container');
            if (!errorContainer) return;

            if (!title && !message) {
                errorContainer.innerHTML = '';
                return;
            }

            errorContainer.innerHTML = `
                <div class="error">
                    <div class="error-title">âŒ ${title}</div>
                    <div>${message}</div>
                </div>
            `;
        }

        /**
         * åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
         */
        async function initializeApp() {
            console.log('ğŸš€ åˆå§‹åŒ–å·¥ä½œç¶“æ­·é é¢...');
            
            try {
                // 1. åˆå§‹åŒ–èªè¨€ç®¡ç†å™¨ï¼ˆè‡ªå‹•å¯«å…¥ URLï¼‰
                const language = LanguageManager.initialize();
                i18nService.initialize(language);
                
                // 2. åˆå§‹åŒ–æ‡‰ç”¨ç‹€æ…‹
                const appState = await WorkExperienceService.initializeApp(language);
                
                // 3. åˆå§‹åŒ–æ¨¡æ…‹æ¡†
                WorkExperienceModal.initialize({
                    containerId: 'modal-container'
                });

                // 4. åˆå§‹åŒ–å°è¦½æ¬„
                Navigation.initialize({
                    containerId: 'navigation',
                    currentLanguage: language,
                    onLanguageChange: (lang) => WorkExperienceService.handleLanguageChange(lang, {
                        LanguageManager,
                        i18nService,
                        WorkExperienceTable,
                        showLoading,
                        showError
                    }),
                    onLogout: Navigation.handleLogout,
                    onMenuClick: Navigation.handleMenuClick
                });

                // 5. æ¸²æŸ“å·¥ä½œç¶“æ­·è¡¨æ ¼
                WorkExperienceTable.initialize({
                    containerId: 'work-experience-table',
                    rows: appState.sortedRows,
                    translations: appState.translations,
                    onRowClick: WorkExperienceService.handleTableRowClick.bind(WorkExperienceService)
                });

                showLoading(false);
                console.log('âœ… æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                showLoading(false);
                showError('æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—', error.message);
                console.error('âŒ è©³ç´°éŒ¯èª¤:', error);
            }
        }

        // æ‡‰ç”¨å•Ÿå‹•
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
